function crElem(e){this.elem=document.createElement("li"),this.elemCheckBox=document.createElement("input"),this.elemSpan=document.createElement("span"),this.elemCheckBox.setAttribute("type","checkbox"),this.elemCheckBox.setAttribute("value",e)}var model={loadTask:function(){var e=new XMLHttpRequest;e.open("GET","php/show-task.php"),e.onload=function(){if(4===e.readyState&&200===e.status){try{var t=JSON.parse(e.responseText)}catch(t){alert(e.responseText)}if(null!=t.current)for(s=0;s<t.current.length;s++)controller.loadTaskComplete(view.taskListCurrent,t.current,s);if(null!=t.completed)for(var s=0;s<t.completed.length;s++)controller.loadTaskComplete(view.taskListCompleted,t.completed,s)}else e.status>=400&&alert(e.status+": "+e.statusText)},e.send()},addTask:function(){var e=new XMLHttpRequest;e.open("GET","php/add-task.php?tasktext="+view.taskText.value),e.onload=function(){4===e.readyState&&200===e.status?isNaN(+e.responseText)?alert(e.responseText):controller.addTaskComplete(e.responseText):e.status>=400&&alert(e.status+": "+e.statusText)},e.send()},removeTask:function(){for(var e=new XMLHttpRequest,t=view.taskListCompleted.querySelectorAll("input:checked"),s=[],n=0;n<t.length;n++)s.push(t[n].value);s=JSON.stringify(s),e.open("GET","php/remove-task.php?donetasks="+s),e.onload=function(){if(4===e.readyState&&200===e.status)if("success"===e.responseText)for(var s=t.length-1;s>=0;s--)controller.removeTaskComplete(t[s].parentElement,view.taskListCompleted);else alert(e.responseText);else e.status>=400&&alert(e.status+": "+e.statusText)},e.send()},changeTable:function(e,t,s){var n=new XMLHttpRequest;n.open("GET","php/"+t+".php?tasktext="+e.elemSpan.innerHTML+"&taskvalue="+e.elemCheckBox.value),n.onload=function(){4===n.readyState&&200===n.status?"success"!==n.responseText?alert(n.responseText):s.call(view):n.status>=400&&alert(n.status+": "+n.statusText)},n.send()},checkForm:function(e){e.preventDefault(),""!==view.taskText.value.trim()&&this.addTask()}},view={formEntry:document.getElementById("form-entry"),taskText:document.getElementById("task-text"),taskListCurrent:document.getElementById("task-list-current"),taskListCompleted:document.getElementById("task-list-completed"),btnDone:document.getElementById("btn-done"),btnDel:document.getElementById("btn-del"),btnCompleted:document.getElementById("btn-completed"),btnResume:document.getElementById("btn-resume"),markItem:[],parElem:[],fillElem:function(e,t){e.elemSpan.innerHTML=t,e.elem.appendChild(e.elemCheckBox),e.elem.appendChild(e.elemSpan)},showTask:function(e,t,s){var n=new crElem(t[s][0]);n.elemCheckBox.setAttribute("name","todelete[]"),this.fillElem(n,t[s][1]),e.appendChild(n.elem)},newTask:function(e){var t=new crElem(e);this.fillElem(t,this.taskText.value),this.taskListCurrent.appendChild(t.elem),view.taskText.value=""},hideTask:function(e,t){t.removeChild(e)},moveTask:function(e,t,s){for(var n=e.querySelectorAll("input:checked"),a=0;a<n.length;a++){var i=new crElem(n[a].value);this.fillElem(i,n[a].nextElementSibling.innerHTML),t===this.taskListCompleted?function(){var e=a,l=i;controller.moveTaskStart(l,"complete-task",function(){t.appendChild(l.elem),this.hideTask(n[e].parentElement,s)})}():t===this.taskListCurrent&&function(){var e=a,l=i;controller.moveTaskStart(l,"resume-task",function(){t.appendChild(l.elem),this.hideTask(n[e].parentElement,s)})}()}},changeTaskList:function(){var e=this.taskListCurrent,t=this.taskListCompleted;"block"==getComputedStyle(e).display?(e.classList.remove("show"),e.classList.add("hide"),t.classList.remove("hide"),t.classList.add("show"),this.btnDone.classList.remove("show"),this.btnDone.classList.add("hide"),this.btnDel.classList.remove("hide"),this.btnDel.classList.add("show"),this.btnResume.classList.remove("hide"),this.btnResume.classList.add("show"),this.btnResume.classList.remove("hide"),this.btnResume.classList.add("show"),this.btnCompleted.innerHTML="Текущие"):(e.classList.remove("hide"),e.classList.add("show"),t.classList.remove("show"),t.classList.add("hide"),this.btnDone.classList.remove("hide"),this.btnDone.classList.add("show"),this.btnDel.classList.remove("show"),this.btnDel.classList.add("hide"),this.btnResume.classList.remove("show"),this.btnResume.classList.add("hide"),this.btnCompleted.innerHTML="Завершенные")}},controller={setUpListener:function(){window.addEventListener("load",model.loadTask),view.formEntry.addEventListener("submit",model.checkForm.bind(model)),view.btnDone.addEventListener("click",view.moveTask.bind(view,view.taskListCurrent,view.taskListCompleted,view.taskListCurrent)),view.btnDel.addEventListener("click",model.removeTask),view.btnCompleted.addEventListener("click",view.changeTaskList.bind(view)),view.btnResume.addEventListener("click",view.moveTask.bind(view,view.taskListCompleted,view.taskListCurrent,view.taskListCompleted))},loadTaskComplete:function(e,t,s){view.showTask(e,t,s)},addTaskComplete:function(e){view.newTask(e)},removeTaskComplete:function(e,t){view.hideTask(e,t)},moveTaskStart:function(e,t,s){model.changeTable(e,t,s)}};controller.setUpListener();